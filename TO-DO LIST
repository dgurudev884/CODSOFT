#include <iostream>
#include <fstream>
#include<string>
#include<sstream>
#include<vector>
using namespace std;
void add(fstream &file){
	string task,status;
			int tno;
			cout<<"Enter the number of tasks:";
			cin>>tno;
			cin.ignore();
			for(int i=0;i<tno;i++){
			cout<<"Enter the task no "<<i+1<<" : ";
			getline(cin,task);
			cout<<"Enter the task's status:";
			getline(cin,status);
			file<<task<<","<<status<<"\n";}
			file.flush();}
int main(){
	while(true){
		cout<<"Enter 1 for adding tasks , 2 to view all tasks, 3 to delete tasks , 4 to update , 5 to stop ";
		int ch;
		cin>>ch;
		if (!(ch==1 || ch==2||ch==3||ch==4||ch==5)){
			cout<<"Invalid choice"<<endl;
			continue;}
		if (ch==1){
				fstream file("database.txt",ios::in|ios::out| ios::app);
				if (!file){
					cerr<<"Error in opening the file"<<endl;
					return 1;
				}

			add(file);
			}
		else if (ch==2){
			cout<<"Your tasks"<<endl;
			string line;
			ifstream fpe("database.txt");
			while(getline(fpe,line)){
				stringstream fp(line);
				string task,status;
				getline(fp,task,',');
				getline(fp,status);
				cout<<"-------------------------------------------------------------"<<endl;
				cout<<"TASK : "<<task<<endl;
				cout<<"STATUS: "<<status<<endl;
				cout<<"--------------------------------------------------------------"<<endl;
				}
				fpe.close();}
		else if(ch==3){
			fstream file("database.txt");
			int tno;
			cout<<"Enter the no of tasks to be deleted:";
			cin>>tno;
			 vector <string> delete_tasks;
			cin.ignore();

			for(int i=0;i<tno;i++){
				
				cout<<"Enter the task no "<<i+1<<" to be deleted ";
				string delt;
				getline(cin,delt);
				delete_tasks.push_back(delt);}
				file.clear();
				file.seekg(0,ios::beg);
				string line;
				fstream fil("new.txt",ios::out);
				while(getline(file,line)){
					string full=line;
					stringstream fp(line);
					string task;
					getline(fp,task,',');
					int key=0;
					for (int i=0;i<tno;i++){
					if (task==delete_tasks[i]){
						key=1;
						break;}}
					if(key==0){
						fil<<full<<"\n";}}
						fil.close();
						file.close();
						remove("database.txt");
						rename("new.txt","database.txt");}
			else if(ch==4){
				fstream file("database.txt",ios::in|ios::out);
				fstream fp("new.txt",ios::out);
				string task,status;
				cout<<"Enter the task to be updated:";
				cin>>task;
				cout<<"Enter the status:";
				cin>>status;
				string line;
				int found=0;
				while(getline(file,line)){
					stringstream s(line);
					string k;
					getline(s,k,',');
					string j;
					getline(s,j);
					if (k==task){
						found=1;
						fp<<k<<","<<status<<"\n";
					}
					else{
						fp<<k<<","<<j<<"\n";}}
						if(found==0){
							cout<<"The given task is not found in the to do list"<<endl;
						}
						fp.flush();
				fp.close();
				file.close();
				remove("database.txt");
				rename("new.txt","database.txt");}
		else{
			break;}}}
